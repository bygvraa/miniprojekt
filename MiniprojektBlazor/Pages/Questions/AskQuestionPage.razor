@page "/questions/ask"

@inject HttpClient http
@inject AppDataService service
@inject NavigationManager navigation

<PageTitle>Stil et spørgsmål</PageTitle>

<h3>Stil et spørgsmål</h3>


<div class="card p-2" style="margin: 1rem 0 0 -1rem; border-radius: 0px">
	<EditForm Model="@newQuestion" OnValidSubmit="@CreateQuestion">

		<div class="form-group">
			<label for="questionSubject" class="col-sm-2 col-form-label">Emne</label>
			<select class="form-control" id="questionSubject" @bind="SubjectId">
				@if (subjects != null)
				{
				<option>--- Vælg et emne ---</option>
					@foreach (var subject in subjects)
					{
						<option value="@subject.Id">@subject.Name</option>
					}
				}
			</select>
		</div>

		<div class="form-group">
			<label for="questionTitle" class="col-sm-2 col-form-label">Overskrift</label>
			<InputText class="form-control" id="questionTitle" placeholder="Overskrift på spørgsmålet" @bind-Value="newQuestion.Title" />
		</div>

		<div class="form-group">
			<label for="questionText" class="col-sm-2 col-form-label">Spørgsmål</label>
			<InputTextArea class="form-control col-sm-2" id="questionText" placeholder="Skriv dit spørgsmål" @bind-Value="newQuestion.Text" />
		</div>

		<div class="form-group">
			<label for="questionUsername" class="col-sm-2 col-form-label">Navn</label>
			<InputText class="form-control" id="questionUsername" placeholder="Skriv dit navn" @bind-Value="newQuestion.Username" />
		</div>

		<button type="submit" class="btn btn-primary m-2">
			Send
		</button>

	</EditForm>
</div>


@code {
	private int SubjectId;
	private SubjectData[]? subjects;
	public QuestionData newQuestion = new() { };

	protected override async Task OnInitializedAsync()
	{
		subjects = await service.ListSubjects();
	}

	private async Task CreateQuestion()
	{
		var _subject = await service.GetSubjectById(SubjectId);

		newQuestion.Subject = _subject;

		await service.CreateQuestion(newQuestion);

		navigation.NavigateTo("questions");
	}

}
